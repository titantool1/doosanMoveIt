unset QT_QPA_PLATFORM
# XRDP/가상환경에서 OpenGL이 약하면(검은 화면/깜빡임 등) 아래를 추가로:
export LIBGL_ALWAYS_SOFTWARE=1




source /opt/ros/humble/setup.bash
source ~/ros2_ws/install/setup.bash

ros2 pkg prefix dsr_description2
ls $(ros2 pkg prefix dsr_description2)/share/dsr_description2/meshes/e0509_white | head

왜 오류가 많이 나냐 (확정적으로 자주 맞는 원인들)
A) 단위/스케일: m(미터)인데 너무 큼

MoveIt/ROS2는 보통 **미터(m)**야.
x=0.5는 50cm라서 가능할 수도 있지만, z=1.2는 120cm… 테이블 위 작업이면 거의 무조건 과해.

대부분 “작업대 위” 데모면 z는 0.10~0.40m 사이가 현실적인 경우가 많아.

B) Frame(좌표계) 혼동

world 기준인지 base_link 기준인지에 따라 같은 숫자가 완전 다른 곳이 돼.
지금 GUI에 “Frame override” 있지? 거기 비워두면 YAML defaults frame 따라가는데, 그 frame이 실제 TF랑 안 맞으면 IK가 자주 죽음.

C) 자세(rpy) 없이 위치만 주면 “해가 무수히 많음”

팔끝이 어떤 방향이든 상관 없다고 하면, IK가 제일 쉬운 해(예: 베이스만 도는 해)로 가거나, 아주 이상한 자세로 가다가 충돌/제한 걸려 실패할 수 있어.

D) Joint limit / collision

avoid_collisions 체크했으면 더 빡세지고, 체크 안 해도 관절 제한은 항상 존재.

“어떤 값을 줘야 잘 움직이냐” (바로 쓸 수 있는 가이드)
1) 먼저 FK 캡처로 “안전한 기준점”을 만든다 (제일 확실)

너 GUI에 Capture Current Pose (FK) 있잖아.

로봇을 움직여도 되는 안전한 자세로 둔다

FK 캡처 → abs xyz가 채워짐

그걸 A로 저장

그 다음부터는 **rel(dx,dy,dz)**로 “조금씩만” 이동시키는 방식이 가장 안정적이야.

추천 rel 범위 (처음 테스트용):

dx, dy: ±0.02 ~ ±0.05 (2~5cm)

dz: ±0.01 ~ ±0.03 (1~3cm)

예:

rel: dx=0.03, dy=0.00, dz=0.00

rel: dx=0.00, dy=0.03, dz=0.00

rel: dx=0.00, dy=0.00, dz=0.02

이렇게 하면 “전체 관절”이 자연스럽게 반응하기 시작해. (특히 자세까지 주면 더)

2) abs로 하고 싶으면 “현재 FK 근처 값”만 살짝 바꿔라

0.5, 0.5, 1.2 같은 임의 좌표부터 찍으면 실패 확률이 확 올라가.

abs는 이렇게:

FK로 얻은 (x0,y0,z0) 기준으로

x=x0±0.03, y=y0±0.03, z=z0±0.02 정도만 바꿔서 테스트

3) “베이스만 도는 느낌” 줄이려면 rpy를 켜라

Waypoints Editor에서 use rpy 체크하고, 일단은 현재 자세 기준으로 고정시키는 게 좋아.

가장 쉬운 방법:

FK 캡처 후, 그 상태에서 rpy도 함께 “고정값”으로 쓰고 싶지만
지금 네 FK 서비스는 position만 가져오고 orientation은 안 넣고 있지?
그래서 당장 쉬운 우회는:

테스트용 고정 rpy 예시(일반적인 ‘툴 아래로’ 자세 느낌):

roll=0, pitch=1.57, yaw=0 (라디안 기준)

또는 pitch=-1.57 도 시도

이 값이 네 로봇/툴 방향과 다르면 IK가 더 실패할 수는 있어. 그럴 땐 yaw만 조금 바꾸거나 pitch 부호 바꿔보면 된다.

“관절이 전부 움직여야 하는데 한 관절만 움직이는 느낌”의 진짜 의미

이건 버그일 수도 있지만, 상당수는 목표가 너무 단순해서 그래.

예를 들어,

end-effector가 목표점까지 가는 가장 쉬운 방법이 베이스 회전이면
IK 해가 “베이스만 돌리는 해”를 선택할 수 있어. 정상임.

확실히 전체 관절이 움직이는지 확인하려면

목표를 “조금 더 멀리” 혹은 “옆 + 위 같이” 주면(예: dx=0.03, dz=0.02 같이)
베이스만으로는 안 돼서 다른 관절이 같이 움직이게 된다.

지금 당장 추천하는 “안전 테스트 시퀀스”

FK 캡처해서 A 저장(abs)

B: rel dx=0.03

C: rel dy=0.03

D: rel dz=0.02

E: rel dx=0.03, dz=0.02 ← 이건 거의 확실히 여러 관절이 같이 움직임

다음 단계로 더 정확히 잡고 싶으면, 네가 **오류 로그 한두 줄(예: IK failed / planning failed / collision / frame transform)**만 붙여줘.
에러 종류에 따라 “값 범위”가 아니라 “프레임/툴 링크/seed/충돌체크” 중 무엇이 원인인지 바로 갈라낼 수 있어.
